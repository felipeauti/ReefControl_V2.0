<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReefControl - Dashboard de Temperatura</title>
    <style>
        :root {
            --primary-color: #2196F3;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
            --danger-color: #F44336;
            --background-color: #f5f5f5;
            --card-background: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
        }

        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .header h1 {
            margin: 0;
            font-size: 2em;
            color: var(--primary-color);
        }

        .header p {
            margin: 5px 0;
            color: #666;
        }

        .sensors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .sensor-card {
            background: var(--card-background);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .sensor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .sensor-name {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 10px;
        }

        .sensor-temp {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 15px 0;
        }

        .sensor-details {
            font-size: 0.9em;
            color: #666;
        }

        .sensor-address {
            font-family: monospace;
            background: #f0f0f0;
            padding: 5px;
            border-radius: 5px;
            font-size: 0.8em;
        }

        .sensor-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-top: 10px;
        }

        .status-ok {
            background: #e8f5e9;
            color: var(--success-color);
        }

        .status-warning {
            background: #fff3e0;
            color: var(--warning-color);
        }

        .status-error {
            background: #ffebee;
            color: var(--danger-color);
        }

        .last-update {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-top: 20px;
        }

        .last-update.status-warning {
            color: var(--warning-color);
            font-weight: bold;
        }

        @media (max-width: 600px) {
            .sensors-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Anima√ß√£o de loading */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        /* Anima√ß√£o de atualiza√ß√£o */
        @keyframes update-flash {
            0% { background-color: var(--card-background); }
            50% { background-color: #e3f2fd; }
            100% { background-color: var(--card-background); }
        }

        .update-flash {
            animation: update-flash 1s ease-out;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üå°Ô∏è Dashboard de Temperatura</h1>
            <p>Monitoramento em tempo real dos sensores</p>
        </div>

        <div id="sensors-grid" class="sensors-grid">
            <!-- Os sensores ser√£o inseridos aqui via JavaScript -->
        </div>

        <div class="last-update" id="last-update">
            √öltima atualiza√ß√£o: --:--:--
        </div>
    </div>

    <script>
        // Fun√ß√£o para formatar a data
        function formatDateTime(date) {
            return date.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'UTC'
            });
        }

        // Fun√ß√£o para classificar o status da temperatura
        function getTemperatureStatus(temp) {
            if (temp < 23) return ['Baixa', 'status-warning'];
            if (temp > 28) return ['Alta', 'status-warning'];
            return ['Normal', 'status-ok'];
        }

        // Fun√ß√£o para atualizar os sensores
        async function updateSensors() {
            try {
                // Busca dados dos sensores e do tempo em paralelo
                const [sensorsResponse, timeResponse] = await Promise.all([
                    fetch('/api/ds18b20/sensors'),
                    fetch('/api/ntp/status')
                ]);
                
                const sensors = await sensorsResponse.json();
                const timeData = await timeResponse.json();
                
                const grid = document.getElementById('sensors-grid');
                
                // Atualiza ou cria cards para cada sensor
                sensors.forEach(sensor => {
                    const [status, statusClass] = getTemperatureStatus(sensor.temperature);
                    const sensorId = `sensor-${sensor.address}`;
                    let sensorCard = document.getElementById(sensorId);
                    
                    const cardHTML = `
                        <div class="sensor-name">${sensor.name}</div>
                        <div class="sensor-temp">${sensor.temperature.toFixed(1)}¬∞C</div>
                        <div class="sensor-details">
                            <div>Temperatura Raw: ${sensor.rawTemperature.toFixed(1)}¬∞C</div>
                            <div>Offset: ${sensor.offset.toFixed(2)}¬∞C</div>
                            <div class="sensor-address">${sensor.address}</div>
                        </div>
                        <div class="sensor-status ${statusClass}">
                            Status: ${status}
                        </div>
                    `;

                    if (sensorCard) {
                        // Atualiza card existente
                        if (sensorCard.innerHTML !== cardHTML) {
                            sensorCard.innerHTML = cardHTML;
                            sensorCard.classList.add('update-flash');
                            setTimeout(() => sensorCard.classList.remove('update-flash'), 1000);
                        }
                    } else {
                        // Cria novo card
                        sensorCard = document.createElement('div');
                        sensorCard.id = sensorId;
                        sensorCard.className = 'sensor-card';
                        sensorCard.innerHTML = cardHTML;
                        grid.appendChild(sensorCard);
                    }
                });

                // Atualiza timestamp usando a hora do servidor NTP
                const lastUpdate = document.getElementById('last-update');
                if (timeData.synchronized) {
                    lastUpdate.textContent = `√öltima atualiza√ß√£o: ${timeData.status}`;
                    lastUpdate.classList.remove('status-warning');
                } else {
                    lastUpdate.textContent = `√öltima atualiza√ß√£o: ${timeData.status} (√öltima sincroniza√ß√£o: ${timeData.lastSync})`;
                    lastUpdate.classList.add('status-warning');
                }

            } catch (error) {
                console.error('Erro ao atualizar sensores:', error);
            }
        }

        // Atualiza imediatamente e depois a cada 5 segundos
        updateSensors();
        setInterval(updateSensors, 5000);
    </script>
</body>
</html> 